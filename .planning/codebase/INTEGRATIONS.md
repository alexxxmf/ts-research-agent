# External Integrations

**Analysis Date:** 2026-02-06

## APIs & External Services

**LLM (Language Model) Services:**
- OpenRouter - Primary LLM provider for research agents
  - SDK/Client: axios-based custom client in `src/providers/LLMProvider.ts`
  - Auth: `OPENROUTER_API_KEY` environment variable
  - Base URL: `https://openrouter.ai/api/v1`
  - Supported models: Llama 3.1 8B, Gemini 2.5 Flash, DeepSeek Chat, Qwen 2.5 72B, and others
  - Pricing tracked per model with prompt/completion token rates
  - Timeout: 120 seconds (2 minutes)
  - Retry strategy: 3 attempts with exponential backoff on 5xx errors and rate limiting (429)

**Search Services:**
- SearXNG - Self-hosted meta-search engine for web searches
  - SDK/Client: axios-based custom client in `src/providers/SearchProvider.ts`
  - Config: `SEARXNG_URL` environment variable (default: `http://localhost:8080`)
  - Multiple instances supported with failover/rotation logic
  - Timeout: 10 seconds (configurable)
  - Retry strategy: Up to 3 retries per instance with exponential backoff
  - Supports instance priority order or random rotation
  - JSON response format with fallback to snippet on scraping failure

**Web Content Scraping:**
- Jina.ai - AI-powered URL content extraction
  - SDK/Client: axios-based custom client in `src/providers/ScraperProvider.ts`
  - Base URL: `https://r.jina.ai/`
  - Auth: No API key required (free tier with rate limits)
  - Rate limiting: 20 requests per second (50ms minimum between requests)
  - Timeout: 30 seconds per scrape
  - Retry strategy: 3 attempts with exponential backoff
  - Response format: Markdown (via `X-Return-Format: markdown` header)
  - Fallback: Returns search snippet if scraping fails

## Data Storage

**Databases:**
- SQLite (better-sqlite3 driver)
  - Connection: Local file path via `storagePath` in `PersistenceConfig`
  - Optional feature: Controlled by `persistence.enabled` in config
  - Used for three main tables:
    - `search_cache`: Caches scraped URL content
    - `llm_cache`: Caches LLM responses by prompt hash
    - `sessions`: Stores resumable session state
  - Cache TTL: Configurable (default 24 hours)
  - Indexes on: `scraped_at`, `created_at`, `updated_at`
  - Auto-cleanup: Expired entries removed on initialization

**File Storage:**
- Local filesystem only
  - SQLite database file (path specified in config)
  - OpenRouter models list cache: `openrouter-models.json` (generated by `fetch-models` script)

**Caching:**
- SQLite-backed in-memory cache with persistence
  - Search result caching: By URL
  - LLM response caching: By SHA256 hash of `{model}:{prompt}`
  - Session caching: By session ID
  - Cache interface: `CacheProvider` in `src/types/index.ts`
  - Implementation: `Cache` class in `src/utils/Cache.ts`

## Authentication & Identity

**Auth Provider:**
- Custom (API Key based)
  - OpenRouter API Key: Required for LLM access
    - Environment variable: `OPENROUTER_API_KEY`
    - Passed as Bearer token in Authorization header
  - SearXNG: No authentication (self-hosted or public instance)
  - Jina.ai: No authentication (free tier, public API)

**Headers & Identification:**
- OpenRouter LLM requests include:
  - `Authorization: Bearer {OPENROUTER_API_KEY}`
  - `HTTP-Referer: https://github.com/research-agent`
  - `X-Title: Research Agent`
- SearXNG requests include:
  - User-Agent: Chrome 120 (to avoid blocking)
  - Accept headers for JSON response
- Jina.ai requests include:
  - `Accept: text/plain`
  - `X-Return-Format: markdown`

## Monitoring & Observability

**Error Tracking:**
- None (no external error tracking service)
- Custom error types defined in `src/types/index.ts`:
  - `LLMError`: LLM generation failures
  - `SearchError`: Search operation failures
  - `RateLimitError`: Rate limiting errors
  - `ResearchAgentError`: General research failures

**Logs:**
- Console-based logging (console.log/warn/error)
- Logging in:
  - `src/providers/SearchProvider.ts`: Search retry logging with emoji indicators
  - `src/providers/LLMProvider.ts`: Error logging on failures
  - `src/providers/ScraperProvider.ts`: Rate limiter statistics
  - `src/utils/Cache.ts`: Cache operation warnings
  - `src/orchestrator/Pipeline.ts`: Research progress events

**Debugging:**
- Console formatter utility: `src/utils/ConsoleFormatter.ts`
- Progress callback mechanism for real-time updates

## CI/CD & Deployment

**Hosting:**
- Not deployed as service (library/CLI tool)
- Distributed via npm as `ts-research-agent` package

**Package Registry:**
- npm (public registry)
- Repository: https://github.com/alexxxmf/research-agent

**Build Artifacts:**
- TypeScript compiled to `dist/` directory (ES2022)
- Source maps included (`sourceMap: true`)
- Declaration files generated (`.d.ts` files)
- `prepublishOnly` hook runs build before publish

## Environment Configuration

**Required env vars:**
- `OPENROUTER_API_KEY` - OpenRouter API key (required for LLM operations)

**Optional env vars:**
- `SEARXNG_URL` - SearXNG instance URL (default: `http://localhost:8080`)

**Configuration Files:**
- `.env` file (not committed, example in `.env.example`)
- Loaded via `dotenv` package on application startup

**Secrets location:**
- `.env` file (git-ignored)
- Never committed to repository

## Rate Limiting & Quotas

**OpenRouter:**
- Rate limiting: Handled via `retry-after` header on 429 responses
- Exponential backoff: Automatic retry with configurable delays
- Max retries: 3 attempts

**SearXNG:**
- Rate limiting: Configurable timeout (10 seconds default)
- Failover: Automatically tries next instance if rate limited
- Multiple instances supported for load balancing

**Jina.ai:**
- Free tier: 20 requests per second
- Rate limiter: Implemented in `src/utils/RateLimiter.ts`
- Queue management: Max 20 concurrent requests with 50ms delay (20/sec)
- Retry: 3 attempts with exponential backoff on 429 responses

## Webhooks & Callbacks

**Incoming:**
- None

**Outgoing:**
- None (library doesn't initiate webhooks)

**Progress Callbacks:**
- Research progress events via `onProgress` callback in `ResearchOptions`
- Progress events defined in `src/types/index.ts`: `ProgressEvent` and `ProgressCallback`
- Event types include: `start`, `searching`, `scraping`, `analyzing`, `complete`

---

*Integration audit: 2026-02-06*
